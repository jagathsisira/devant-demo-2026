<?xml version="1.0" encoding="UTF-8"?>
<api context="/ordersummary" name="OrderSummaryAPI" version="1.0.0" version-type="url"
    xmlns="http://ws.apache.org/ns/synapse">
    <resource methods="GET" uri-template="/{OrderId}" faultSequence="CommonFaultSequence">
        <inSequence>
            <property name="uri.var.orderid" scope="default" type="STRING"
                expression="${params.pathParams.OrderId}" />
            <variable name="orderid" type="INTEGER" expression="${params.pathParams.OrderId}" />
            <log category="INFO" logMessageID="false" logFullPayload="true">
                <message>***** Order details request received</message>
                <property name="Order Id" expression="${vars.orderid}" />
            </log>
            <call>
                <endpoint key="OrderDataServiceEndpoint" />
            </call>
            <sequence key="OrderDetailsExtractSequence" />
            <property name="uri.var.customerid" scope="default" type="STRING"
                expression="${vars.customerid}" />
            <log category="INFO" logMessageID="false" logFullPayload="true">
                <message>***** Order details extracted</message>
                <property name="Order Id" expression="${vars.orderid}" />
            </log>
            <header name="Content-Type" action="remove" scope="transport" />
            <call>
                <endpoint key="CustomerDataServiceEndpoint" />
            </call>
            <sequence key="CustomerDetailsExtractSequence" />
            <log category="INFO" logMessageID="false" logFullPayload="true">
                <message>***** Customer details extracted</message>
                <property name="Customer Id" expression="${vars.customerid}" />
            </log>
            <payloadFactory media-type="json" template-type="default">
                <format>{ "OrderSummary": { "OrderDetails":{ "OrderId":${vars.orderid},
                    "ProductId":"${vars.productid}", "Quantity": ${vars.qty},
                    "OrderDateTme":"${vars.orderdate}" }, "CustomerDetails": { "Name":
                    "${vars.firstname} ${vars.lastname}", "City": "${vars.city}" } } }</format>
            </payloadFactory>
            <log category="INFO" logMessageID="false" logFullPayload="true">
                <message>***** Order details response sent</message>
                <property name="Order Id" expression="${vars.orderid}" />
                <property name="Customer Id" expression="${vars.customerid}" />
            </log>
            <respond />
        </inSequence>
    </resource>
</api>